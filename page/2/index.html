<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Ye&#39;s Tech Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Ye&#39;s Tech Blog">
<meta property="og:url" content="https://wy3148.github.io/page/2/index.html">
<meta property="og:site_name" content="Ye&#39;s Tech Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ye&#39;s Tech Blog">
  
    <link rel="alternate" href="/atom.xml" title="Ye&#39;s Tech Blog" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>
</html>
<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class="" href="/index.html">Home</a></li>
        
          <li><a class="" href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">Ye&#39;s Tech Blog</h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          
  
    <article id="post-golang-map-internal" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/10/golang-map-internal/">the map internal of Golang</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2019/02/10/golang-map-internal/" class="article-date"><time datetime="2019-02-09T13:30:47.000Z" itemprop="datePublished">2019-02-10</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>golang map is implemented in hashmap.<br>a hashmap is combined with a hash table array and each array node is a linked list.</p>
<p>unlike C++, golang is using a fixed size of array to replace linked list, and if there<br>are conflicts of new key-value pairs, golang will put the key-value pairs into a<br>‘extra’ bucket.</p>
<p>the bucket is defined,</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A bucket for a Go map.</span></span><br><span class="line">type bmap <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="comment">// tophash generally contains the top byte of the hash value</span></span><br><span class="line">	<span class="comment">// for each key in this bucket. If tophash[0] &lt; minTopHash,</span></span><br><span class="line">	<span class="comment">// tophash[0] is a bucket evacuation state instead.</span></span><br><span class="line">	tophash [bucketCnt]uint8</span><br><span class="line">	<span class="comment">// Followed by bucketCnt keys and then bucketCnt values.</span></span><br><span class="line">	<span class="comment">// <span class="doctag">NOTE:</span> packing all the keys together and then all the values together makes the</span></span><br><span class="line">	<span class="comment">// code a bit more complicated than alternating key/value/key/value/... but it allows</span></span><br><span class="line">	<span class="comment">// us to eliminate padding which would be needed for, e.g., map[int64]int8.</span></span><br><span class="line">	<span class="comment">// Followed by an overflow pointer.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>the map is defined as ‘hmap’,</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A header for a Go map.</span></span><br><span class="line">type hmap <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="comment">// Note: the format of the hmap is also encoded in cmd/compile/internal/gc/reflect.go.</span></span><br><span class="line">	<span class="comment">// Make sure this stays in sync with the compiler's definition.</span></span><br><span class="line">	count     <span class="keyword">int</span> <span class="comment">// # live cells == size of map.  Must be first (used by len() builtin)</span></span><br><span class="line">	flags     uint8</span><br><span class="line">	B         uint8  <span class="comment">// log_2 of # of buckets (can hold up to loadFactor * 2^B items)</span></span><br><span class="line">	noverflow uint16 <span class="comment">// approximate number of overflow buckets; see incrnoverflow for details</span></span><br><span class="line">	hash0     uint32 <span class="comment">// hash seed</span></span><br><span class="line"></span><br><span class="line">	buckets    unsafe.Pointer <span class="comment">// array of 2^B Buckets. may be nil if count==0.</span></span><br><span class="line">	oldbuckets unsafe.Pointer <span class="comment">// previous bucket array of half the size, non-nil only when growing</span></span><br><span class="line">	nevacuate  uintptr        <span class="comment">// progress counter for evacuation (buckets less than this have been evacuated)</span></span><br><span class="line"></span><br><span class="line">	extra *mapextra <span class="comment">// optional fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>when to access the element,(remove unrelated code)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">func mapaccess1(t *maptype, h *hmap, key unsafe.Pointer) unsafe.Pointer</span><br><span class="line"></span><br><span class="line">    //hash function to calculate the index of the bucket,</span><br><span class="line"></span><br><span class="line">	hash := alg.hash(key, uintptr(h.hash0)) </span><br><span class="line">	m := bucketMask(h.B)</span><br><span class="line"></span><br><span class="line">    bucketloop:</span><br><span class="line"></span><br><span class="line">    //find the element from current bucket,</span><br><span class="line">	for ; b != nil; b = b.overflow(t) &#123;</span><br><span class="line">		for i := uintptr(0); i &lt; bucketCnt; i++ &#123;</span><br><span class="line">			if b.tophash[i] != top &#123;</span><br><span class="line">				if b.tophash[i] == emptyRest &#123;</span><br><span class="line">					break bucketloop</span><br><span class="line">				&#125;</span><br><span class="line">				continue</span><br><span class="line">			&#125;</span><br><span class="line">			k := add(unsafe.Pointer(b), dataOffset+i*uintptr(t.keysize))</span><br><span class="line">			if t.indirectkey() &#123;</span><br><span class="line">				k = *((*unsafe.Pointer)(k))</span><br><span class="line">			&#125;</span><br><span class="line">			if alg.equal(key, k) &#123;</span><br><span class="line">				v := add(unsafe.Pointer(b), dataOffset+bucketCnt*uintptr(t.keysize)+i*uintptr(t.valuesize))</span><br><span class="line">				if t.indirectvalue() &#123;</span><br><span class="line">					v = *((*unsafe.Pointer)(v))</span><br><span class="line">				&#125;</span><br><span class="line">				return v</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>from the source code, we can understand why map is not safe.<br>And new version of golang has added new sync map.<br><a href="https://golang.org/pkg/sync/#Map" target="_blank" rel="noopener">https://golang.org/pkg/sync/#Map</a></p>
<p>Additonally,<br>map is passed by the address,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func makemap(t *maptype, hint int, h *hmap) *hmap</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func f1(m map[string]string) &#123;</span><br><span class="line">	m[&quot;name&quot;] = &quot;bingo&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func f0() &#123;</span><br><span class="line">	m := make(map[string]string)</span><br><span class="line">	m[&quot;name&quot;] = &quot;John&quot;</span><br><span class="line">	f1(m)</span><br><span class="line">	fmt.Println(m[&quot;name&quot;])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>above code will change the value of map element, this is different with slice.</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2019/02/10/golang-map-internal/" data-id="ckd5uh94n000ghgii2ph63m3j" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/">Golang</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-lua-string-match" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/18/lua-string-match/">lua-string match the magic characters</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2019/01/18/lua-string-match/" class="article-date"><time datetime="2019-01-17T23:47:59.000Z" itemprop="datePublished">2019-01-18</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>to escapse the  magic character , we have to use ‘%’ to turn off pattern match when call string.find or gsub functions</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function test_string()</span><br><span class="line">    local name = &quot;res$&#123;CALLERID(name)&#125;&quot;</span><br><span class="line">    local s1,s2 = string.gsub(name,&quot;$%&#123;CALLERID%(name%)%&#125;&quot;, &quot;lilizhou&quot;)</span><br><span class="line">    print(s1)</span><br><span class="line">    print(s2)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>in the exampe, we try to replace the whole string ‘${CALLERID(name)}’ with a new string.</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2019/01/18/lua-string-match/" data-id="ckd5uh95o0026hgii2yiefy4v" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lua/">lua</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-lua-date-time" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/13/lua-date-time/">date and time functions in lua</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/09/13/lua-date-time/" class="article-date"><time datetime="2017-09-13T06:55:22.000Z" itemprop="datePublished">2017-09-13</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>os.date ([format [, time]])</p>
<p>Returns a string or a table containing date and time, formatted according to the given string format.</p>
<p>If the time argument is present, this is the time to be formatted (see the os.time function for a description of this value). Otherwise, date formats the current time.</p>
<p>If format starts with ‘!’, then the date is formatted in Coordinated Universal Time. After this optional character, if format is the string “*t”, then date returns a table with the following fields: year (four digits), month (1–12), day (1–31), hour (0–23), min (0–59), sec (0–61), wday (weekday, Sunday is 1), yday (day of the year), and isdst (daylight saving flag, a boolean).</p>
<p>If format is not “*t”, then date returns the date as a string, formatted according to the same rules as the C function strftime.</p>
<p>When called without arguments, date returns a reasonable date and time representation that depends on the host system and on the current locale (that is, os.date() is equivalent to os.date(“%c”)).</p>
<p>os.time ([table])</p>
<p>Returns the current time when called without arguments, or a time representing the date and time specified by the given table. This table must have fields year, month, and day, and may have fields hour, min, sec, and isdst (for a description of these fields, see the os.date function).</p>
<p>The returned value is a number, whose meaning depends on your system. In POSIX, Windows, and some other systems, this number counts the number of seconds since some given start time (the “epoch”). In other systems, the meaning is not specified, and the number returned by time can be used only as an argument to date and difftime.</p>
<p>code examples</p>
<p>get the current time as a table variable<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">"*t"</span>)</span><br></pre></td></tr></table></figure></p>
<p>get the time based on the time offset, if we know the time offset, we can get time with a different timezone with current system setting</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- offset is -10 hours, which is 36000 in seconds</span></span><br><span class="line"><span class="keyword">local</span> t = <span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">"*t"</span>,<span class="built_in">os</span>.<span class="built_in">time</span>()<span class="number">-36000</span>)</span><br></pre></td></tr></table></figure>
<p>what if we don’t know the time offset, but know the timezone in linux environment,<br>one of the possible way is to using ‘zdump’ command in linux system<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">local</span> command= <span class="string">"zdump "</span></span><br><span class="line"><span class="keyword">local</span> handle = <span class="built_in">io</span>.<span class="built_in">popen</span>(command)</span><br><span class="line"><span class="keyword">local</span> result = handle:<span class="built_in">read</span>(<span class="string">"*a"</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">handle:<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/09/13/lua-date-time/" data-id="ckd5uh95m0022hgiiwma52m7w" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lua/">lua</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-awd-s3-go-sdk" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/11/awd-s3-go-sdk/">Go sdk for amazon AWs</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/09/11/awd-s3-go-sdk/" class="article-date"><time datetime="2017-09-11T12:01:27.000Z" itemprop="datePublished">2017-09-11</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>##get the aws-go sdk<br>cd $GOPATH/src</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">go get github.com/aws/aws-sdk-go</span><br></pre></td></tr></table></figure>
<p>##get the asw access key and secret</p>
<p>get the access key and secret<br>reference:<br><a href="http://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html" target="_blank" rel="noopener">http://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html</a></p>
<p>get the data center region information<br>aws-sdk go requires region information of the data center<br><a href="http://docs.aws.amazon.com/general/latest/gr/rande.html" target="_blank" rel="noopener">http://docs.aws.amazon.com/general/latest/gr/rande.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">export AWS_ACCESS_KEY_ID=your access key</span><br><span class="line">export AWS_SECRET_ACCESS_KEY=your access secret</span><br><span class="line">export AWS_REGION=ap-southeast-2</span><br></pre></td></tr></table></figure>
<p>sample code</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"flag"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/aws/aws-sdk-go/aws"</span></span><br><span class="line">	<span class="string">"github.com/aws/aws-sdk-go/aws/awserr"</span></span><br><span class="line">	<span class="string">"github.com/aws/aws-sdk-go/aws/request"</span></span><br><span class="line">	<span class="string">"github.com/aws/aws-sdk-go/aws/session"</span></span><br><span class="line">	<span class="string">"github.com/aws/aws-sdk-go/service/s3"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Uploads a file to S3 given a bucket and object key. Also takes a duration</span></span><br><span class="line"><span class="comment">// value to terminate the update if it doesn't complete within that time.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The AWS Region needs to be provided in the AWS shared config or on the</span></span><br><span class="line"><span class="comment">// environment variable as `AWS_REGION`. Credentials also must be provided</span></span><br><span class="line"><span class="comment">// Will default to shared config file, but can load from environment if provided.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Usage:</span></span><br><span class="line"><span class="comment">//   # Upload myfile.txt to myBucket/myKey. Must complete within 10 minutes or will fail</span></span><br><span class="line"><span class="comment">//   go run withContext.go -b mybucket -k myKey -d 10m &lt; myfile.txt</span></span><br><span class="line"><span class="function">func <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	var bucket, key string</span><br><span class="line">	var timeout time.Duration</span><br><span class="line"></span><br><span class="line">	flag.StringVar(&amp;bucket, <span class="string">"b"</span>, <span class="string">""</span>, <span class="string">"Bucket name."</span>)</span><br><span class="line">	flag.StringVar(&amp;key, <span class="string">"k"</span>, <span class="string">""</span>, <span class="string">"Object key name."</span>)</span><br><span class="line">	flag.DurationVar(&amp;timeout, <span class="string">"d"</span>, <span class="number">0</span>, <span class="string">"Upload timeout."</span>)</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// All clients require a Session. The Session provides the client with</span></span><br><span class="line">	<span class="comment">// shared configuration such as region, endpoint, and credentials. A</span></span><br><span class="line">	<span class="comment">// Session should be shared where possible to take advantage of</span></span><br><span class="line">	<span class="comment">// configuration and credential caching. See the session package for</span></span><br><span class="line">	<span class="comment">// more information.</span></span><br><span class="line">	sess := session.Must(session.NewSession())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create a new instance of the service's client with a Session.</span></span><br><span class="line">	<span class="comment">// Optional aws.Config values can also be provided as variadic arguments</span></span><br><span class="line">	<span class="comment">// to the New function. This option allows you to provide service</span></span><br><span class="line">	<span class="comment">// specific configuration.</span></span><br><span class="line">	svc := s3.New(sess)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create a context with a timeout that will abort the upload if it takes</span></span><br><span class="line">	<span class="comment">// more than the passed in timeout.</span></span><br><span class="line">	ctx := context.Background()</span><br><span class="line">	<span class="function">var cancelFn <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	<span class="keyword">if</span> timeout &gt; 0 </span>&#123;</span><br><span class="line">		ctx, cancelFn = context.WithTimeout(ctx, timeout)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Ensure the context is canceled to prevent leaking.</span></span><br><span class="line">	<span class="comment">// See context package for more information, https://golang.org/pkg/context/</span></span><br><span class="line">	<span class="function">defer <span class="title">cancelFn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	<span class="comment">// Uploads the object to S3. The Context will interrupt the request if the</span></span></span><br><span class="line"><span class="function">	<span class="comment">// timeout expires.</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	inputObj :</span>= &amp;s3.PutObjectInput&#123;</span><br><span class="line">		Bucket: aws.String(bucket),</span><br><span class="line">		Key:    aws.String(key),</span><br><span class="line">		Body:   os.Stdin,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	inputObj.SetACL(s3.BucketCannedACLPublicRead)</span><br><span class="line"></span><br><span class="line">	_, err := svc.PutObjectWithContext(ctx, inputObj)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		<span class="keyword">if</span> aerr, ok := err.(awserr.Error); ok &amp;&amp; aerr.Code() == request.CanceledErrorCode &#123;</span><br><span class="line">			<span class="comment">// If the SDK can determine the request or retry delay was canceled</span></span><br><span class="line">			<span class="comment">// by a context the CanceledErrorCode error code will be returned.</span></span><br><span class="line">			fmt.Fprintf(os.Stderr, <span class="string">"upload canceled due to timeout, %v\n"</span>, err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Fprintf(os.Stderr, <span class="string">"failed to upload object, %v\n"</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"successfully uploaded file to %s/%s\n"</span>, bucket, key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>so run the main.go file to upload the local ‘myfile.txt’ file<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">go run main.go -b mybucket -k myKey -d 10m &lt; myfile.txt</span><br></pre></td></tr></table></figure></p>
<p>##how to change ‘ACL’ (access control) </p>
<p>S3 API support different ACL policy of an object, here is the example about how to change the file to ‘public’ read<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inputObj.SetACL(s3.BucketCannedACLPublicRead)</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/09/11/awd-s3-go-sdk/" data-id="ckd5uh94h0006hgii5qb6uo5b" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws-go-sdk/">aws-go-sdk</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-http-performance-testing" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/05/http-performance-testing/">benchmark tools for http/https/restAPI testing</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/09/05/http-performance-testing/" class="article-date"><time datetime="2017-09-05T00:21:10.000Z" itemprop="datePublished">2017-09-05</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>#Benchmark tools</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/ApacheBench" target="_blank" rel="noopener"><strong>ab</strong></a> – slow and single threaded, written in <code>C</code></li>
<li><a href="https://github.com/apigee/apib" target="_blank" rel="noopener"><strong>apib</strong></a> – most of the features of ApacheBench (<code>ab</code>), also designed as a <a href="https://github.com/apigee/apib#design" target="_blank" rel="noopener">more modern replacement</a>, written in <code>C</code></li>
<li><a href="https://github.com/h2non/baloo" target="_blank" rel="noopener"><strong>baloo</strong></a> – Expressive end-to-end HTTP API testing made easy, written in Go (<code>golang</code>)</li>
<li><a href="https://github.com/codesenberg/bombardier" target="_blank" rel="noopener"><strong>bombardier</strong></a> – Fast crossplatform HTTP benchmarking tool, written in Go (<code>golang</code>)</li>
<li><a href="http://curl-loader.sourceforge.net/" target="_blank" rel="noopener"><strong>curl-loader</strong></a> – performance loading of various application services and traffic generation, written in <code>C</code></li>
<li><a href="https://github.com/hagen1778/fasthttploader" target="_blank" rel="noopener"><strong>fasthttploader</strong></a> – benchmark (kinda ab) with autoadjustment and charts based on fasthttp library, write in Go (<code>golang</code>)</li>
<li><a href="http://gatling.io" target="_blank" rel="noopener"><strong>gatling</strong></a> – High performance load testing framework based on Scala, Akka and Netty, write in <code>Scala</code></li>
<li><a href="https://github.com/gophergala2016/goad" target="_blank" rel="noopener"><strong>goad</strong></a> – Goad is an AWS Lambda powered, highly distributed, load testing tool, write in Go (<code>golang</code>)</li>
<li><a href="https://github.com/cmpxchg16/gobench" target="_blank" rel="noopener"><strong>gobench</strong></a> – HTTP/HTTPS load testing and benchmarking tool, write in Go (<code>golang</code>)</li>
<li><a href="https://github.com/parkghost/gohttpbench" target="_blank" rel="noopener"><strong>gohttpbench</strong></a> – <code>ab</code>-like benchmark tool run on multi-core cpu, write in Go (<code>golang</code>)</li>
<li><a href="https://github.com/rakyll/hey" target="_blank" rel="noopener"><strong>hey</strong></a> – HTTP(S) load generator, ApacheBench (<code>ab</code>) replacement, formerly known as <a href="https://github.com/rakyll/boom" target="_blank" rel="noopener"><strong>rakyll/boom</strong></a>, written in Go (<code>golang</code>)</li>
<li><a href="https://github.com/arut/htstress" target="_blank" rel="noopener"><strong>htstress</strong></a> – multithreading high-load bechmarking services (&gt;5K rps), written in <code>C</code>/<code>Linux</code></li>
<li><a href="https://github.com/httperf/httperf" target="_blank" rel="noopener"><strong>httperf</strong></a> – difficult configuration, slow and single threaded, written in <code>C</code></li>
<li><a href="https://github.com/opsengine/inundator" target="_blank" rel="noopener"><strong>inundator</strong></a> – A simple and high-throughput HTTP flood program, written in <code>C</code>/<code>Linux</code></li>
<li><a href="http://jmeter.apache.org/" target="_blank" rel="noopener"><strong>jmeter</strong></a> – Apache  JMeter™, pure application designed to load test performance both on static and dynamic resources, written in <code>Java</code></li>
<li><a href="https://github.com/byorty/mgun" target="_blank" rel="noopener"><strong>mgun</strong></a> – A modern tool for load testing HTTP servers, written in Go (<code>golang</code>)</li>
<li><a href="https://github.com/X4/pounce" target="_blank" rel="noopener"><strong>pounce</strong></a> – evented, but results fluctuate, it’s sometimes faster than <code>htstress</code>, written in <code>C</code></li>
<li><a href="http://www.joedog.org/siege-home/" target="_blank" rel="noopener"><strong>siege</strong></a> – slow and single threaded, written in <code>C</code></li>
<li><a href="https://github.com/ikruglov/slapper" target="_blank" rel="noopener"><strong>slapper</strong></a> – Simple load testing tool with real-time updated histogram of request timings, written in Go (<code>golang</code>)</li>
<li><a href="https://github.com/BuoyantIO/slow_cooker" target="_blank" rel="noopener"><strong>slow_cooker</strong></a> – A load tester focused on lifecycle issues and long-running tests, service with a predictable load and concurrency level for a long period of time, written in Go (<code>golang</code>)</li>
<li><a href="https://github.com/lubia/sniper" target="_blank" rel="noopener"><strong>sniper</strong></a> – powerful &amp; high-performance http load tester, written in Go (<code>golang</code>)</li>
<li><a href="http://tsung.erlang-projects.org/" target="_blank" rel="noopener"><strong>tsung</strong></a> – Simulate stress users in order to test the scalability and performance of IP based client/server applications <code>HTTP</code>, <code>WebDAV</code>, <code>SOAP</code>, <code>PostgreSQL</code>, <code>MySQL</code>, <code>LDAP</code> and <code>Jabber</code>/<code>XMPP</code> servers, written in <code>Erlang</code></li>
<li><a href="https://github.com/tsenart/vegeta" target="_blank" rel="noopener"><strong>vegeta</strong></a> – HTTP load testing tool and library, written in Go (<code>golang</code>)</li>
<li><a href="https://github.com/lighttpd/weighttp" target="_blank" rel="noopener"><strong>weighttp</strong></a> – multithreaded, but slower than htstress without keepalive, written in <code>C</code></li>
<li><a href="https://github.com/wg/wrk" target="_blank" rel="noopener"><strong>wrk</strong></a> – multithreaded<del>, but doesn’t offer concurrent connections and a keepalive switch</del>, written in <code>C</code>/<code>Lua</code></li>
<li><p><a href="https://github.com/giltene/wrk2" target="_blank" rel="noopener"><strong>wrk2</strong></a> – constant throughput, correct latency recording variant of wrk, written in <code>C</code>/<code>Lua</code></p>
<pre><code>Concurrent connections are enabled with:
  -c, --connections &lt;N&gt;  Connections to keep open
And keepalive (which is default) can be disabled using:
  -H &quot;Connection: close&quot;
</code></pre></li>
<li><a href="https://github.com/yandex/yandex-tank" target="_blank" rel="noopener"><strong>yandex-tank</strong></a> – Load and performance benchmark tool, written in <code>Python</code>/<code>C|C++|Asm</code> (<a href="https://github.com/yandex-load/phantom" target="_blank" rel="noopener">phantom</a>)</li>
</ul>
<h1 id="Toolkit-for-testing-debugging-HTTP-S-and-restAPI-RESTful"><a href="#Toolkit-for-testing-debugging-HTTP-S-and-restAPI-RESTful" class="headerlink" title="Toolkit for testing/debugging HTTP(S) and restAPI (RESTful)"></a>Toolkit for testing/debugging HTTP(S) and restAPI (RESTful)</h1><ul>
<li><a href="https://github.com/astaxie/bat" target="_blank" rel="noopener"><strong>bat</strong></a> – Go implement CLI, cURL-like tool for humans, written in Go (<code>golang</code>)</li>
<li><a href="https://github.com/curl/curl" target="_blank" rel="noopener"><strong>curl</strong></a> – Powerful features command-line tool for transferring data specified with URL syntax, written in <code>C</code><ul>
<li><a href="https://curlbuilder.com/" target="_blank" rel="noopener">Online curl command line builde</a></li>
</ul>
</li>
<li><a href="https://github.com/NickCarneiro/curlconverter" target="_blank" rel="noopener"><strong>curlconverter</strong></a> – convert curl commands to python, javascript, php</li>
<li><a href="https://github.com/jkbrzt/httpie" target="_blank" rel="noopener"><strong>httpie</strong></a> – client, user-friendly curl replacement with intuitive UI, JSON support, syntax highlighting, wget-like downloads, extensions, written in <code>Python</code></li>
<li><a href="https://github.com/stedolan/jq" target="_blank" rel="noopener"><strong>jq</strong></a> – is a lightweight and flexible command-line JSON processor, written in <code>C</code></li>
</ul>
<h1 id="SaaS-PaaS"><a href="#SaaS-PaaS" class="headerlink" title="SaaS/PaaS"></a>SaaS/PaaS</h1><ul>
<li><a href="https://www.blitz.io/" target="_blank" rel="noopener"><strong>blitz.io</strong></a> – an easy solution to load and performance testing from the Cloud. Test scaliability on websites, mobile, web apps and REST APIs.</li>
<li><a href="https://blazemeter.com/" target="_blank" rel="noopener"><strong>BlazeMeter</strong></a> – offers a cross-enterprise test automation framework for the entire technical team (developers, devops, ops and QA) throughout the product development lifecycle. Run continuous or ‘on demand’ testing for APIs, mobile apps and websites. Run from the cloud, on-premise or as a hybrid solution. Use with JMeter &amp; Selenium WebDriver &amp; integrate with your existing CI, CD &amp; APM tools.</li>
<li><a href="http://newrelic.com/" target="_blank" rel="noopener"><strong>NewRelic</strong></a> – software analytics tool suite used by developers, ops, and software companies to understand how your applications are performing in development and production</li>
<li><a href="https://amplify.nginx.com/" target="_blank" rel="noopener"><strong>NGINX Amplify</strong></a> – Visually identify performance bottlenecks, overloaded servers, or potential DDoS attacks. Improve and optimize NGINX performance with intelligent advice and recommendations. Get alerts when something is wrong with the delivery of your application. Plan capacity and performance for web applications. Keep track of systems running NGINX <a href="https://www.nginx.com/blog/announcing-amplify/" target="_blank" rel="noopener"><sup>1</sup></a></li>
</ul>
<h1 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h1><ul>
<li><a href="http://testutils.org/multi-mechanize/" target="_blank" rel="noopener">Multi-Mechanize | Performance Test Framework</a></li>
<li><a href="http://www.opensourcetesting.org/performance.php" target="_blank" rel="noopener">Performance test tools list</a></li>
<li><a href="https://insomnia.rest/" target="_blank" rel="noopener">REST API client</a> - simple, beautiful, and free REST API client (<code>Mac</code>, <code>Windows</code>, and <code>Linux</code>)</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/09/05/http-performance-testing/" data-id="ckd5uh950000vhgii5nq65648" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/benchmark-tools/">benchmark tools</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-golang-context" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/04/golang-context/">golang-context examples</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/09/04/golang-context/" class="article-date"><time datetime="2017-09-04T01:21:54.000Z" itemprop="datePublished">2017-09-04</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>#context with cancel<br>parent go routine cancel the child goroutine,<br>when parent routine stops to consume more messages, it call context.Cancel() function<br>to signal the child routine</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// gen generates integers in a separate goroutine and</span></span><br><span class="line">	<span class="comment">// sends them to the returned channel.</span></span><br><span class="line">	<span class="comment">// The callers of gen need to cancel the context once</span></span><br><span class="line">	<span class="comment">// they are done consuming generated integers not to leak</span></span><br><span class="line">	<span class="comment">// the internal goroutine started by gen.</span></span><br><span class="line">	gen := <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		dst := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">		n := <span class="number">1</span></span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">for</span> &#123;</span><br><span class="line">				<span class="keyword">select</span> &#123;</span><br><span class="line">				<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">					<span class="keyword">return</span> <span class="comment">// returning not to leak the goroutine</span></span><br><span class="line">				<span class="keyword">case</span> dst &lt;- n:</span><br><span class="line">					n++</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line">		<span class="keyword">return</span> dst</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">	<span class="keyword">defer</span> cancel() <span class="comment">// cancel when we are finished consuming integers</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> n := <span class="keyword">range</span> gen(ctx) &#123;</span><br><span class="line">		fmt.Println(n)</span><br><span class="line">		<span class="keyword">if</span> n == <span class="number">5</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#context with value</p>
<p>we can pass some value from routines to routines, about the ‘key’, it’s not suggested using<br>string data type directly</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="comment">// "net"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TracId <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">moreTime</span><span class="params">(c context.Context)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	v := c.Value(TracId(<span class="string">"src"</span>))</span><br><span class="line">	fmt.Println(<span class="string">"remote src is:"</span>, v.(<span class="keyword">string</span>))</span><br><span class="line"></span><br><span class="line">	res := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line">	time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">	res &lt;- <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	c := r.Context()</span><br><span class="line">	newC := context.WithValue(c, TracId(<span class="string">"src"</span>), r.RemoteAddr)</span><br><span class="line">	<span class="keyword">go</span> moreTime(newC)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	http.HandleFunc(<span class="string">"/foo"</span>, foo)</span><br><span class="line">	http.ListenAndServe(<span class="string">":8081"</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#context with timeout</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="comment">// "net"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TracId <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">moreTime</span><span class="params">(c context.Context)</span> &lt;-<span class="title">chan</span> <span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	res := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="built_in">close</span>(res)</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">				fmt.Println(<span class="string">"overslept"</span>)</span><br><span class="line">				res &lt;- <span class="string">"working\n"</span></span><br><span class="line">			<span class="keyword">case</span> &lt;-c.Done():</span><br><span class="line">				fmt.Println(c.Err()) <span class="comment">// prints "context deadline exceeded"</span></span><br><span class="line">				res &lt;- <span class="string">"timeout\n"</span></span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), <span class="number">5</span>*time.Second)</span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">	res := moreTime(ctx)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> res &#123;</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(v))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	http.HandleFunc(<span class="string">"/foo"</span>, foo)</span><br><span class="line">	http.ListenAndServe(<span class="string">":8081"</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>when we don’t want to the response forever, we can set a timeout in this way,<br>we need to check the ‘error’ response of client.Do() function<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ctx, cancel := context.WithTimeout(context.Background(), <span class="number">10</span>*time.Second)</span><br><span class="line"><span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">client := <span class="built_in">new</span>(http.Client)</span><br><span class="line">req, _ := http.NewRequest(<span class="string">"GET"</span>, <span class="string">"http://192.168.2.59:8081/foo"</span>, <span class="literal">nil</span>)</span><br><span class="line">copyReq := req.WithContext(ctx)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1024</span>)</span><br><span class="line">	ress.Body.Read(b)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/09/04/golang-context/" data-id="ckd5uh94j0009hgii5k0zyzqo" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-golang-return-channel-in-func" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/04/golang-return-channel-in-func/">golang-return channel vs retufn &lt;- channel</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/09/04/golang-return-channel-in-func/" class="article-date"><time datetime="2017-09-03T23:43:02.000Z" itemprop="datePublished">2017-09-04</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://stackoverflow.com/questions/31920353/whats-the-difference-between-chan-and-chan-as-a-function-return-type" target="_blank" rel="noopener">https://stackoverflow.com/questions/31920353/whats-the-difference-between-chan-and-chan-as-a-function-return-type</a></p>
<p>in golang, some functions can return ‘channel’, and some functions return channel with prefix:’ &lt;- ‘</p>
<p>Golang newbie here.</p>
<p>Is there a functional difference between</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">func <span class="title">randomNumberGenerator</span><span class="params">()</span> &lt;-chan <span class="keyword">int</span> </span>&#123;</span><br><span class="line">and</span><br><span class="line"></span><br><span class="line"><span class="function">func <span class="title">randomNumberGenerator</span><span class="params">()</span> chan <span class="keyword">int</span> </span>&#123;</span><br><span class="line">I<span class="string">'ve tried using both and they seem to work fine for me.</span></span><br></pre></td></tr></table></figure>
<p>I’ve seen the former used by Rob Pike (one of Go creators) in his Go Concurrency Patterns talk at Google IO 2012. I’ve also seen it used in Go’s official website. Why add 2 extra characters (“&lt;-“) when you can omit it? I’ve tried looking for the difference on the web, but couldn’t find it.</p>
<p>Both will work indeed. But one will be more constraining. The form with the arrow pointing away from the chan keyword means that the returned channel will only be able to be pulled from by client code. No pushing allowed : the pushing will be done by the random number generator function. Conversely, there’s a third form with the arrow pointing towards chan, that makes said channel write-only to clients.</p>
<p>chan   // read-write<br>&lt;-chan // read only<br>chan&lt;- // write only<br>These added constraints can improve the expression of intent and tighten the type system : attempts to force stuff into a read-only channel will leave you with a compilation error, and so will attempts to read from a write-only channel. These constraints can be expressed in the return type, but they can also be part of the parameter signature. Like in :</p>
<p>func log(&lt;-chan string) { …<br>There you can know, just by the signature, that the log function will consume data from the channel, and not send any to it.</p>
<p>code sample</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">func <span class="title">shopping</span><span class="params">(num <span class="keyword">int</span>)</span> &lt;-chan <span class="keyword">int</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	res := make(chan <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="function">go <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="function">defer <span class="title">close</span><span class="params">(res)</span></span></span><br><span class="line"><span class="function">		time.<span class="title">Sleep</span><span class="params">(<span class="number">5</span> * time.Second)</span></span></span><br><span class="line"><span class="function">		res &lt;- 100</span></span><br><span class="line"><span class="function">	&#125;<span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	return res</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">func <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	v := shopping(<span class="number">5</span>)</span><br><span class="line">	v &lt;- <span class="number">100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It will generate the compile error<br>invalid operation: v &lt;- 100 (send to receive-only type &lt;-chan int)</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/09/04/golang-return-channel-in-func/" data-id="ckd5uh94r000jhgiizxbnms6z" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-golang-sync-Map" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/01/golang-sync-Map/">try sync.Map in golang 1.9</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/09/01/golang-sync-Map/" class="article-date"><time datetime="2017-09-01T00:08:51.000Z" itemprop="datePublished">2017-09-01</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/golang/">golang</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Golang 1.9 new version support safe Map now, details can be found,</p>
<p><a href="https://golang.org/pkg/sync/#Map.Load" target="_blank" rel="noopener">https://golang.org/pkg/sync/#Map.Load</a></p>
<p>Here is sample code, test filename is ‘sync_map.go’</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeProc</span><span class="params">(m *sync.Map, c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        i := <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            v, ok := m.Load(<span class="string">"ok1"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ok &#123;</span><br><span class="line">                fmt.Println(<span class="string">"get the ok 1"</span>)</span><br><span class="line">                fmt.Println(v)</span><br><span class="line">                c &lt;- <span class="number">1</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fmt.Printf(<span class="string">"does not get the key element, sleep for one second, counting: %d\n"</span>, i)</span><br><span class="line">            i++</span><br><span class="line">            time.Sleep(<span class="number">1000</span> * time.Millisecond)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	m := <span class="built_in">new</span>(sync.Map)</span><br><span class="line"></span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">	writeProc(m, c)</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">	m.Store(<span class="string">"ok1"</span>, <span class="string">"goood!!!"</span>)</span><br><span class="line">	&lt;-c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>output example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">go run sync_map.go </span><br><span class="line">does not get the key element, sleep for one second, counting: 0</span><br><span class="line">does not get the key element, sleep for one second, counting: 1</span><br><span class="line">does not get the key element, sleep for one second, counting: 2</span><br><span class="line">does not get the key element, sleep for one second, counting: 3</span><br><span class="line">does not get the key element, sleep for one second, counting: 4</span><br><span class="line">does not get the key element, sleep for one second, counting: 5</span><br><span class="line">does not get the key element, sleep for one second, counting: 6</span><br><span class="line">does not get the key element, sleep for one second, counting: 7</span><br><span class="line">does not get the key element, sleep for one second, counting: 8</span><br><span class="line">does not get the key element, sleep for one second, counting: 9</span><br><span class="line">get the ok 1</span><br><span class="line">goood!!!</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/09/01/golang-sync-Map/" data-id="ckd5uh94u000lhgiio0mxtn2d" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-leetcode-binary-tree-max-depth" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/25/leetcode-binary-tree-max-depth/">leetcode-binary-tree-max-depth</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/25/leetcode-binary-tree-max-depth/" class="article-date"><time datetime="2017-08-25T12:14:54.000Z" itemprop="datePublished">2017-08-25</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/leetcode-binary-tree/">leetcode binary tree</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Given a binary tree, find its maximum depth.</p>
<p>The maximum depth is the number of nodes along the longest path from the root node down to the farthest leaf node.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> left = <span class="keyword">this</span>.maxDepth(root.left);</span><br><span class="line">        <span class="keyword">int</span> right = <span class="keyword">this</span>.maxDepth(root.right);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(left &gt; right)&#123;</span><br><span class="line">            <span class="keyword">return</span> left + <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> right+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/08/25/leetcode-binary-tree-max-depth/" data-id="ckd5uh95l001zhgiik30xppfw" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>


    </footer>
  </div>
  
</article>



  
    <article id="post-leetcode-binary-tree-bfs-avarage-value" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/25/leetcode-binary-tree-bfs-avarage-value/">Average of Levels in Binary Tree</a>
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/08/25/leetcode-binary-tree-bfs-avarage-value/" class="article-date"><time datetime="2017-08-25T04:50:50.000Z" itemprop="datePublished">2017-08-25</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/leetcode/">leetcode</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Given a non-empty binary tree, return the average value of the nodes on each level in the form of an array.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Example 1:</span><br><span class="line">Input:</span><br><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line">Output: [3, 14.5, 11]</span><br></pre></td></tr></table></figure>
<p>Explanation:<br>The average value of nodes on level 0 is 3,  on level 1 is 14.5,<br>and on level 2 is 11. Hence return [3, 14.5, 11].<br>Note:<br>The range of node’s value is in the range of 32-bit signed integer.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Double&gt; <span class="title">averageOfLevels</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        List&lt;Double&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) <span class="keyword">return</span> result;</span><br><span class="line">        q.add(root);</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> n = q.size(); <span class="comment">// this is number of nodes in current level</span></span><br><span class="line">            <span class="keyword">double</span> sum = <span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                TreeNode node = q.poll();</span><br><span class="line">                sum += node.val;</span><br><span class="line">                <span class="keyword">if</span>(node.left != <span class="keyword">null</span>) q.offer(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right != <span class="keyword">null</span>) q.offer(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(sum / n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://wy3148.github.io/2017/08/25/leetcode-binary-tree-bfs-avarage-value/" data-id="ckd5uh95j001vhgiiz841aa89" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>


    </footer>
  </div>
  
</article>



  


  <div id="page-nav">
    <nav><ul class="pagination"><li><a class="page-prev" rel="prev" href="/"><i class="fa fa-chevron-left"></i> Prev</a></li><li><a class="page-number" href="/">1</a></li><li class="active"><span class="page-number">2</span></li><li><a class="page-number" href="/page/3/">3</a></li><li><a class="page-number" href="/page/4/">4</a></li><li><a class="page-next" rel="next" href="/page/3/">Next <i class="fa fa-chevron-right"></i></a></li></ul></nav>
  </div>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p>welcome to my tech blog</p> <p>https://www.linkedin.com/in/wy3148/</p>

</div>


  
  <div class="sidebar-module">
    <h4>Categories</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/golang/">golang</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/java/">java</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/leetcode/">leetcode</a><span class="sidebar-module-list-count">7</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/leetcode-binary-tree/">leetcode binary tree</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/old-posts-in-wordpress-blog/">old posts in wordpress blog</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/ubuntu-LTS/">ubuntu LTS</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/zookeeper/">zookeeper</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/07/">July 2020</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/05/">May 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/04/">April 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/11/">November 2019</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/10/">October 2019</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/02/">February 2019</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2019/01/">January 2019</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/09/">September 2017</a><span class="sidebar-module-list-count">6</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/08/">August 2017</a><span class="sidebar-module-list-count">12</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/07/">July 2017</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2020/07/28/java-jdbc-mysql/">simple jdbc example to connect mysql</a>
        </li>
      
        <li>
          <a href="/2020/07/27/java-simple-redis/">java_simple_redis</a>
        </li>
      
        <li>
          <a href="/2020/07/27/java-begin-maven/">java use maven</a>
        </li>
      
        <li>
          <a href="/2020/05/19/tea-party-md/">tea_party.md</a>
        </li>
      
        <li>
          <a href="/2020/04/20/binary-search-all/">binary search algorithm--different ways in coding</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2020 YE WANG<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
